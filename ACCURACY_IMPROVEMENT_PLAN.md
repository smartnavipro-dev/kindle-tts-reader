# OCR認識精度 100%達成計画

## 現状分析

### 現在の精度レベル
- **ML Kit OCR生データ**: 66% (AvgConf: 0.66)
  - HighConf要素: 94% (18/19)
  - 主な問題: 似た形の漢字、カタカナ、濁点の誤認識

- **Phase 1パターン補正後**: 30% (8パターン適用)
  - パターンマッチングが複雑化を招き信頼度低下

- **Gemini LLM補正後**: **96%** ← 現在の最終精度
  - 目標: **100%**（+4%向上）

### 主要な誤認識パターン

1. **漢字の形状類似**
   - 英/経、作/会、数/効、郵/要

2. **カタカナ誤認識**
   - コースト（余分な長音符）、mスト（文字化け）

3. **濁点・半濁点**
   - よつて/よって

4. **助詞・接続詞**
   - れほど/どれほど、|風変わった/一風変わった

---

## 改善策（優先度順）

### 🟢 **即実装可能（v1.0.56）** - 推定効果: +2%

#### 1. LLMプロンプト最適化
**現状のプロンプト問題点:**
- コンテキスト情報が不足
- 日本語特有の誤認識パターンの説明がない
- 信頼度計算基準が曖昧

**改善策:**
```kotlin
// より詳細なプロンプト
val enhancedPrompt = """
あなたは日本語OCRテキストの校正専門家です。

【入力テキストの特徴】
- Kindle電子書籍からのOCR抽出結果
- 縦書きテキスト（右から左へ読む）
- 形状類似による漢字誤認識（英/経、作/会、数/効）
- カタカナ誤認識（長音符、文字化け）
- 濁点・半濁点の誤認識

【校正タスク】
1. 文脈から正しい単語を推測
2. 日本語として自然な表現に修正
3. 専門用語（経済学、機会費用など）は正確に修正
4. 信頼度は以下の基準で評価:
   - 1.0: 誤認識なし、完璧
   - 0.95: 1-2箇所の軽微な修正
   - 0.90: 3-5箇所の修正
   - 0.85: 6-10箇所の修正

【入力テキスト】
$ocrText

【出力形式】
{
  "corrected": "校正後のテキスト",
  "confidence": 0.95
}
"""
```

**推定効果**: 96% → 97.5% (+1.5%)

---

#### 2. 反復補正機構（Iterative Refinement）
**アプローチ:**
- 低信頼度（< 0.95）の場合、補正結果を再度LLMに送信
- 最大2回の反復で精度向上

**実装:**
```kotlin
suspend fun correctWithRefinement(text: String): CorrectionResult {
    var result = invokeLLM(text)

    // 信頼度が0.95未満なら再補正
    if (result.confidence < 0.95) {
        val refinementPrompt = """
        以下は1回目の校正結果です。さらに精度を高めてください。

        校正後テキスト:
        ${result.correctedText}

        信頼度: ${result.confidence}

        再度確認し、誤りがあれば修正してください。
        """
        result = invokeLLM(refinementPrompt)
    }

    return result
}
```

**推定効果**: 97.5% → 98.5% (+1%)

**コスト**: 約20%のケースで2倍のAPI呼び出し（信頼度<0.95時）

---

### 🟡 **中期実装（v1.0.57-58）** - 推定効果: +1.5%

#### 3. ML Kit OCR前処理強化

**画像処理最適化:**
```kotlin
fun preprocessImage(bitmap: Bitmap): Bitmap {
    // 1. コントラスト強調
    val contrastEnhanced = enhanceContrast(bitmap, factor = 1.5)

    // 2. シャープ化
    val sharpened = sharpen(contrastEnhanced, amount = 1.2)

    // 3. ノイズ除去
    val denoised = gaussianBlur(sharpened, sigma = 0.5)

    // 4. 二値化（適応的閾値）
    val binarized = adaptiveThreshold(denoised)

    return binarized
}
```

**推定効果**: ML Kit OCR 66% → 75% → 最終 99% (+0.5%)

---

#### 4. OCR信頼度ベースのハイブリッド処理

**アプローチ:**
- HighConfブロック（信頼度 > 0.9）: パターン補正のみ
- MedConfブロック（0.7-0.9）: Phase 1 + LLM
- LowConfブロック（< 0.7）: 反復LLM補正

```kotlin
when (block.confidence) {
    in 0.9..1.0 -> applyPatternCorrection(block)
    in 0.7..0.9 -> applyPhase1AndLLM(block)
    else -> applyIterativeLLM(block, maxIterations = 2)
}
```

**推定効果**: 99% → 99.5% (+0.5%)

---

### 🔴 **長期実装（v1.1.0+）** - 推定効果: +0.5%

#### 5. ユーザーフィードバック機構

**インタラクティブ補正:**
- 読み上げ中にユーザーが誤認識を報告
- 補正辞書に追加
- 機械学習で補正精度向上

**UI:**
```
[読み上げ中]
「英学者がよく口する...」

👤 ユーザー: 誤認識報告
   - 誤: 英学者
   - 正: 経済学者

✅ 辞書に追加 → 以降は自動補正
```

**推定効果**: 99.5% → 99.8% (+0.3%)

---

#### 6. カスタムOCRモデル（Fine-tuning）

**アプローチ:**
- Kindle書籍特化のOCRモデル訓練
- ML Kit + カスタムモデルのアンサンブル

**技術:**
- TensorFlow Lite
- EasyOCR fine-tuning
- 書籍フォント特化学習

**推定効果**: 99.8% → 99.95% (+0.15%)

---

## 実装ロードマップ

### v1.0.56（即実装）
- [x] 現状分析完了
- [x] LLMプロンプト最適化（詳細なOCR誤認識パターン追加）
- [x] 反復補正機構実装（閾値0.8→0.95に引き上げ）
- **目標精度**: 98.5%

### v1.0.57（2週間）
- [ ] 画像前処理強化
- [ ] ハイブリッド処理実装
- **目標精度**: 99.5%

### v1.1.0（1ヶ月）
- [ ] ユーザーフィードバックUI
- [ ] 補正辞書システム
- **目標精度**: 99.8%

### v1.2.0（3ヶ月）
- [ ] カスタムOCRモデル研究
- [ ] アンサンブル学習
- **目標精度**: **99.95%** ≈ **100%**

---

## コスト試算

### v1.0.56（反復補正）
- 現在: $0.0003/補正
- 反復後: $0.0006/補正（信頼度<0.95の20%のケース）
- 平均: $0.00036/補正 (+20%)
- 月間（3,000補正）: $1.08/月 (+$0.18)

### v1.0.57-58（前処理強化）
- コスト増加なし（ローカル処理）

### v1.1.0+（ユーザーフィードバック）
- コスト増加なし（辞書ベース）

---

## まとめ

### 短期目標（v1.0.56）
- **現在**: 96%
- **目標**: 98.5%
- **実装期間**: 1-2日
- **コスト増**: +20% ($0.90 → $1.08/月)

### 中期目標（v1.0.57-58）
- **目標**: 99.5%
- **実装期間**: 2週間
- **コスト増**: なし

### 長期目標（v1.1.0+）
- **目標**: **99.95% ≈ 100%**
- **実装期間**: 1-3ヶ月
- **コスト増**: なし

**結論**: 100%精度は実現可能。段階的な改善で着実に到達できます。
