# 🚀 Kindle TTS Reader - 完全セットアップガイド

**バージョン**: 1.1.0
**最終更新日**: 2025年12月20日

---

## 📋 目次

1. [システム要件](#システム要件)
2. [インストール前の確認事項](#インストール前の確認事項)
3. [ステップバイステップ インストール](#ステップバイステップ-インストール)
4. [権限の設定](#権限の設定)
5. [Gemini API の設定](#gemini-api-の設定)
6. [初回使用方法](#初回使用方法)
7. [設定画面の使い方](#設定画面の使い方)
8. [動作確認](#動作確認)
9. [次のステップ](#次のステップ)

---

## 📱 システム要件

### 最小要件
- **OS**: Android 5.0 (Lollipop, API 21) 以上
- **RAM**: 最小2GB、推奨4GB
- **ストレージ**: 100MB の空き容量（アプリ50MB + キャッシュ50MB）
- **画面**: 最小解像度 720x1280 ピクセル

### 推奨要件
- **OS**: Android 8.0 (Oreo, API 26) 以上
- **RAM**: 4GB 以上
- **ストレージ**: 200MB の空き容量
- **インターネット**: Gemini API 用に Wi-Fi またはモバイルデータ（オプション）

### 必要なアプリ
- **Kindle アプリ**: Google Play ストアから最新版をインストール
- **書籍**: Kindle アプリに少なくとも1冊ダウンロード済み

---

## ✅ インストール前の確認事項

Kindle TTS Reader をインストールする前に、以下を確認してください：

- [ ] Android デバイスが最小要件を満たしている
- [ ] Kindle アプリがインストールされ、ログイン済み
- [ ] Kindle アプリに少なくとも1冊の本がダウンロード済み
- [ ] 十分なストレージ容量がある
- [ ] （オプション）精度向上のため Gemini API キーを用意

---

## 📦 ステップバイステップ インストール

### 方法1: ビルド済みAPKをインストール（推奨）

#### ステップ1: APKをダウンロード

1. Android デバイスでブラウザを開く
2. 以下にアクセス: https://github.com/smartnavipro-dev/kindle-tts-reader/releases/latest
3. `kindle-tts-reader-v1.1.0-release.apk`（83MB）をダウンロード

#### ステップ2: 不明なソースを許可

**Android 8.0以降の場合:**
1. プロンプトが表示されたら「設定」をタップ
2. 「この提供元を許可する」を有効化
3. インストール画面に戻る

**Android 7.1以前の場合:**
1. 設定 → セキュリティ に移動
2. 「提供元不明のアプリ」を有効化
3. 警告を確認

#### ステップ3: APKをインストール

1. ダウンロードフォルダまたは通知を開く
2. ダウンロードした APK ファイルをタップ
3. 「インストール」をタップ
4. インストールが完了するまで待つ
5. 「開く」をタップするか、アプリドロワーからアプリを見つける

---

### 方法2: ソースからビルド

#### 前提条件
- Android Studio Arctic Fox 以降
- JDK 11 以上
- Git インストール済み

#### ビルド手順

```bash
# リポジトリをクローン
git clone https://github.com/smartnavipro-dev/kindle-tts-reader.git
cd kindle-tts-reader

# デバッグ APK をビルド
./gradlew assembleDebug

# リリース APK をビルド（署名が必要）
./gradlew assembleRelease

# APK の場所
# デバッグ: app/build/outputs/apk/debug/app-debug.apk
# リリース: app/build/outputs/apk/release/app-release.apk
```

---

## 🔐 権限の設定

Kindle TTS Reader は3つの必須権限が必要です。順番に許可してください：

### 権限1: オーバーレイ権限

**必要な理由**: Kindle アプリの上に浮動コントロールを表示するため
**リスクレベル**: 低 - 浮動アプリの標準機能

**手順:**
1. Kindle TTS Reader を起動
2. 「画面キャプチャを有効化」ボタンをタップ
3. システムプロンプト: 「他のアプリの上に表示」
4. リストから「Kindle TTS Reader」をタップ
5. 「他のアプリの上に表示」をONに切り替え
6. アプリに戻る（戻るボタン）

**確認:**
- ステータステキストに「準備完了」と表示される
- ボタンが有効になる

---

### 権限2: アクセシビリティ権限

**必要な理由**: Kindle アプリで自動ページめくりを実行するため
**リスクレベル**: 中 - アクセシビリティサービスは広範なアクセス権を持つ

**手順:**
1. 「アクセシビリティサービスを有効化」をタップ
2. 設定 → ユーザー補助 → ダウンロード済みのサービス に移動
3. 「Kindle TTS Auto Page Turn」を見つける
4. ONに切り替え
5. 権限警告を読む
6. 「OK」または「許可」をタップ
7. アプリに戻る

**確認:**
- 通知バーにアクセシビリティサービスのインジケーターが表示される
- アプリのステータスがサービスがアクティブであることを確認

**セキュリティ注意事項:**
- この権限により、アプリはタッチジェスチャーをシミュレートできます
- ページめくりにのみ使用され、データ収集には使用されません
- Android 設定からいつでも無効化できます

---

### 権限3: 画面キャプチャ権限

**必要な理由**: OCR テキスト抽出のために Kindle 画面をキャプチャするため
**リスクレベル**: 高 - 画面上のすべてのコンテンツをキャプチャ可能

**手順:**
1. 「読み上げ開始」ボタンをタップ
2. Android が「画面のキャプチャを開始しますか?」ダイアログを表示
3. 「今後表示しない」をチェック（オプション）
4. 「今すぐ開始」をタップ

**確認:**
- ステータスバーに録画インジケーターが表示される
- アプリがキャプチャと処理を開始

**プライバシー注意事項:**
- Kindle アプリの画面のみが処理されます
- 画像は OCR 後すぐに破棄されます
- ストレージにスクリーンショットは保存されません
- すべての処理は端末上で実行（オプションの Gemini API を除く）

---

## 🤖 Gemini API の設定

### Gemini API は必要ですか?

**ビルド済みAPK**: API キーがすでに含まれており、すぐに動作します
**ソースからビルド**: 独自の API キーが必要です

### API キーの取得

#### ステップ1: Google AI Studio にアクセス
1. ブラウザを開く: https://aistudio.google.com/app/apikey
2. Google アカウントでサインイン

#### ステップ2: API キーを作成
1. 「API キーを作成」をクリック
2. プロジェクトを選択または作成
3. 生成されたキーをコピー（`AIza...` で始まる）
4. 安全に保存

### API キーの設定（ソースビルドのみ）

#### オプション A: ビルド時設定
```bash
# プロジェクトルートディレクトリで
echo "GEMINI_API_KEY=AIzaSy..." >> local.properties

# API キーを指定してビルド
./gradlew assembleRelease -PGEMINI_API_KEY="AIzaSy..."
```

#### オプション B: 環境変数
```bash
# Linux/macOS
export GEMINI_API_KEY="AIzaSy..."

# Windows PowerShell
$env:GEMINI_API_KEY="AIzaSy..."
```

### コスト情報

**無料枠**（個人利用に最適）:
- 1日あたり500リクエスト
- 1分あたり250,000トークン
- クレジットカード不要

**有料利用**（無料枠を超えた場合）:
- 1回の補正あたり約$0.0003（0.03円）
- 月間の典型的なコスト: 3,000回の補正で約$0.90
- モニター: https://aistudio.google.com/app/apikey

---

## 🎬 初回使用方法

### プライバシー同意（v1.1.0以降）

初回起動時にプライバシー同意ダイアログが表示されます：

**ダイアログの内容:**
- ローカル学習機能の説明
- データ保存と暗号化の詳細
- ユーザーの権利（いつでもデータを表示・削除可能）

**選択肢:**
- **同意する**: 精度向上のためローカル学習を有効化
- **同意しない**: 学習なしでアプリを使用（完全に機能します）

**後で設定画面で変更できます!**

---

### アプリのテスト

#### ステップ1: Kindle 本を開く
1. Kindle アプリを起動
2. テキストコンテンツのある本を開く
3. テストしたいページに移動

#### ステップ2: Kindle TTS Reader を起動
1. Kindle TTS Reader を開く
2. すべての権限が許可されていることを確認（緑のチェックマーク）
3. 「読み上げ開始」をタップ

#### ステップ3: 画面キャプチャを許可
1. システムダイアログで「今すぐ開始」をタップ
2. アプリが自動的に Kindle に切り替わる

#### ステップ4: 動作を確認
1. Kindle 画面に浮動オーバーレイが表示される
2. OCR 処理が開始される（ステータステキストを確認）
3. テキスト読み上げが開始される
4. 読み上げ完了時に自動的にページがめくれる

**予想される時間:**
- 初回キャプチャ: 1-2秒
- OCR 処理: 2-3秒
- 最初の読み上げ: 合計3-5秒
- 以降のページ: 1-2秒（キャッシュ済み）

---

## ⚙️ 設定画面の使い方

### 設定画面へのアクセス

1. Kindle TTS Reader のメイン画面を開く
2. 右上の「⚙️」（設定アイコン）をタップ
3. 設定画面が開く

---

### 学習機能の設定

#### ローカル学習の有効化/無効化

**パス**: 設定 → ローカル学習機能

**選択肢:**
- **ON**: アプリが補正から学習（推奨）
- **OFF**: 学習なし、手動補正のみ

**効果:**
- ON の場合: パターンマッチングが時間とともに改善
- OFF の場合: デフォルトの OCR + Gemini API のみ使用

---

#### 学習統計の表示

**パス**: 設定 → 学習パターン統計

**表示される情報:**
- 学習済みパターンの総数
- 最終更新のタイムスタンプ
- 使用ストレージサイズ

**例:**
```
学習パターン数: 47
最終更新: 2025-12-20 14:30:25
ストレージ使用量: 12 KB
```

---

#### すべての学習データを削除

**パス**: 設定 → すべてのデータを削除

**警告**: この操作は元に戻せません!

**手順:**
1. 「すべてのデータを削除」をタップ
2. ダイアログで削除を確認
3. すべての学習パターンが永久に削除される
4. アプリが初期インストール状態に戻る

**使用するタイミング:**
- 蓄積された誤ったパターンをクリア
- 異なるタイプの読書材料に切り替え
- プライバシーの懸念（デバイスを売却・譲渡する前）

---

### プライバシー設定

#### プライバシーポリシーの表示

**パス**: 設定 → プライバシーポリシー

**利用可能な言語:**
- 日本語（デフォルト）
- 英語（ダイアログで切り替え）

**内容:**
- データ収集の実践
- 暗号化の詳細
- ユーザーの権利（GDPR）
- 連絡先情報

---

#### データの場所

すべての学習データは以下に保存されます:
```
/data/data/com.kindletts.reader/shared_prefs/local_corrections
```

**暗号化**: AES256-GCM
**鍵の保存**: Android Keystore（ハードウェア保護）
**バックアップ**: Google Drive バックアップから除外

---

## ✔️ 動作確認

### セットアップ成功のチェックリスト

以下のチェックリストを実行して、すべてが正しく動作することを確認してください:

- [ ] アプリがエラーなくインストールされる
- [ ] 3つの権限がすべて許可されている
- [ ] プライバシー同意を受け入れた（または意図的に拒否）
- [ ] Kindle アプリに本がダウンロードされている
- [ ] 読み上げ開始時に画面キャプチャが開始される
- [ ] OCR が正しくテキストを抽出（オーバーレイステータスを確認）
- [ ] テキスト読み上げが正しい言語で発音
- [ ] 自動的にページがめくれる
- [ ] オーバーレイコントロールがタッチに反応
- [ ] 設定画面にアクセス可能
- [ ] 学習機能のステータスが選択を反映

### 成功の一般的な指標

✅ **良い兆候:**
- ステータステキストに「読み上げ中...」と表示
- ページ番号が自動的に増加
- 読み上げの質が自然で明瞭
- ページ間の遅延がない
- 学習パターンが蓄積される（有効化している場合）

❌ **警告兆候:**
- ステータスが「処理中...」で停止
- ページがめくれない
- 無音の再生
- 頻繁にクラッシュ
- [トラブルシューティングガイド](TROUBLESHOOTING_ja.md)を参照

---

## 🎯 次のステップ

### 体験を最適化

1. **読み上げ速度を調整**
   - 設定 → テキスト読み上げ → 読み上げ速度
   - 0.8倍から1.5倍の範囲を試す

2. **ページめくりタイミングを微調整**
   - さまざまな本のレイアウトで実験
   - 動作しない本について問題を報告

3. **API 使用量をモニター**
   - Gemini API ダッシュボードを週1回確認
   - 無料枠の制限内に留まる

4. **学習パターンに貢献**
   - （将来の機能）コミュニティ向けにパターンをエクスポート

### ヘルプを得る

- 📖 **トラブルシューティング**: [TROUBLESHOOTING_ja.md](TROUBLESHOOTING_ja.md)
- ❓ **FAQ**: [FAQ_EXTENDED_ja.md](FAQ_EXTENDED_ja.md)
- 🔒 **プライバシー**: [PRIVACY_GUIDE_ja.md](PRIVACY_GUIDE_ja.md)
- 🐛 **バグ報告**: [GitHub Issues](https://github.com/smartnavipro-dev/kindle-tts-reader/issues)
- 💬 **コミュニティ**: [GitHub Discussions](https://github.com/smartnavipro-dev/kindle-tts-reader/discussions)

---

## 📞 サポート

困ったことがあれば、私たちがサポートします!

- **GitHub Issues**: https://github.com/smartnavipro-dev/kindle-tts-reader/issues
- **メール**: contact@smartnavipro.dev
- **プライバシーに関する質問**: privacy@smartnavipro.dev

---

**良い読書体験を! 📚🔊**

---

*最終更新: 2025年12月20日*
*ドキュメントバージョン: 1.0*
*アプリバージョン: 1.1.0*
