# Kindle TTS Reader v1.0.17 開発計画

**作成日**: 2025年11月15日
**ターゲットリリース**: 2025年11月16日
**開発目的**: v1.0.16テスト結果に基づくOCR精度向上

---

## 📋 開発背景

### v1.0.16テスト結果から判明した問題点

#### 1. 類似漢字の誤認識
| 誤認識 | 正解 | 頻度 | 影響度 |
|--------|------|------|--------|
| 講要 | 需要 | 中 | 高 |
| 再将 | 価格 | 低 | 高 |
| 酒頼 | 酒類 | 低 | 中 |
| 祝歌 | 効果 | 低 | 中 |
| 書要 | 需要 | 中 | 高 |

#### 2. カタカナの誤認識
| 誤認識 | 正解 | 頻度 | 影響度 |
|--------|------|------|--------|
| くッピーマワー | ハッピーアワー | 中 | 中 |
| ブライムデー | プライムデー | 低 | 低 |
| マ | ー | 中 | 中 |

#### 3. その他の認識問題
- 文頭文字の欠落（低頻度）
- 数字・記号の認識精度が低い
- 「出れる」→「出される」など活用形の誤認識

---

## 🎯 v1.0.17の開発目標

### 主要目標
1. **OCR認識率を90-95%に向上**（現状: 85-90%）
2. **経済用語の誤認識を50%削減**
3. **カタカナ長音記号の認識精度向上**

### 副次目標
- コード品質の維持
- 処理速度の悪化防止（現状: 560ms以下を維持）

---

## 🔧 実装機能

### 機能1: テキスト後処理フィルター（PostOCRFilter）

#### 概要
OCR認識後のテキストに対して、よくある誤認識パターンを自動修正

#### 実装内容

##### 1.1 経済用語辞書
```kotlin
class EconomicTermsDictionary {
    private val commonMisrecognitions = mapOf(
        // 需要関連
        "講要" to "需要",
        "書要" to "需要",
        "霜要" to "需要",

        // 価格関連
        "再将" to "価格",
        "価将" to "価格",
        "洒格" to "価格",

        // 効果関連
        "祝歌" to "効果",
        "勅果" to "効果",

        // その他経済用語
        "酒頼" to "酒類",
        "催引き" to "値引き",
        "経演" to "経済"
    )
}
```

##### 1.2 カタカナ補正フィルター
```kotlin
class KatakanaCorrector {
    fun correctLongVowel(text: String): String {
        // 「マ」→「ー」などの補正
        // 「くッピー」→「ハッピー」など
    }

    fun correctSmallKana(text: String): String {
        // 小文字カタカナの補正
    }
}
```

##### 1.3 コンテキストベース補正
```kotlin
class ContextualCorrector {
    fun correctByContext(text: String): String {
        // 前後の文脈から判断して補正
        // 例: 「出れる」→「出される」
    }
}
```

### 機能2: 信頼度ベースのフィルタリング

#### 概要
OCR信頼度が低い（<0.5）要素に対して、より積極的な補正を適用

#### 実装内容
```kotlin
class ConfidenceBasedFilter {
    fun filterLowConfidence(
        elements: List<Text.Element>,
        threshold: Float = 0.5f
    ): String {
        // 低信頼度要素を特定して補正
    }
}
```

### 機能3: ユーザー辞書機能（将来実装の準備）

#### 概要
ユーザーが頻繁に読む本のジャンルに応じた専門用語辞書

#### 実装内容（骨組みのみ）
```kotlin
class UserDictionary {
    // v1.0.17では骨組みのみ
    // v1.1.0で完全実装予定
}
```

---

## 📁 ファイル構成

### 新規作成ファイル
```
app/src/main/java/com/kindletts/reader/
├── ocr/
│   ├── PostOCRFilter.kt          # メインフィルタークラス
│   ├── EconomicTermsDictionary.kt # 経済用語辞書
│   ├── KatakanaCorrector.kt      # カタカナ補正
│   └── ConfidenceBasedFilter.kt  # 信頼度ベースフィルター
```

### 修正ファイル
```
app/src/main/java/com/kindletts/reader/
├── OverlayService.kt             # フィルター統合
└── build.gradle                  # バージョン更新
```

---

## 🔄 実装手順

### ステップ1: 経済用語辞書の実装
1. `EconomicTermsDictionary.kt` 作成
2. よくある誤認識パターン50-100個登録
3. 単純な文字列置換機能実装

### ステップ2: カタカナ補正フィルターの実装
1. `KatakanaCorrector.kt` 作成
2. 長音記号補正機能
3. 小文字カタカナ補正機能

### ステップ3: OverlayServiceへの統合
1. OCR認識後にフィルターを適用
2. ログ出力（補正前・補正後）
3. パフォーマンステスト

### ステップ4: バージョン更新とビルド
1. `build.gradle` のバージョン更新（v1.0.17）
2. クリーンビルド
3. 実機テスト

---

## 📊 期待される改善効果

### OCR精度向上予測

| 項目 | v1.0.16 | v1.0.17目標 | 改善率 |
|------|---------|-------------|--------|
| **総合認識率** | 85-90% | 90-95% | +5% |
| **経済用語認識** | 70-75% | 85-90% | +15% |
| **カタカナ認識** | 80-85% | 88-93% | +8% |

### 処理速度予測

| 処理 | 時間 |
|------|------|
| OCR本体 | 560ms |
| 後処理フィルター | +10-20ms |
| **合計** | **570-580ms** |

増加: 10-20ms（許容範囲内）

---

## ✅ テスト計画

### 単体テスト
1. 経済用語辞書の置換テスト
2. カタカナ補正の正確性テスト
3. 処理速度ベンチマーク

### 統合テスト
1. v1.0.16と同じテストページでOCR精度比較
2. 複数ジャンルの本でテスト
3. 長時間動作テスト

### 成功基準
- ✅ OCR認識率が90%以上
- ✅ 処理時間が600ms以下
- ✅ 既存機能に影響なし

---

## 📅 開発スケジュール

| 日付 | タスク | 担当 | 状態 |
|------|--------|------|------|
| 11/15 | 開発計画作成 | AI | ✅ |
| 11/15 | 経済用語辞書実装 | AI | 🔄 |
| 11/15 | カタカナ補正実装 | AI | ⏳ |
| 11/15 | OverlayService統合 | AI | ⏳ |
| 11/15 | バージョン更新・ビルド | AI | ⏳ |
| 11/15 | 実機テスト | User | ⏳ |
| 11/16 | リリースノート作成 | AI | ⏳ |

---

## 🔒 リスク管理

### 潜在的リスク

| リスク | 確率 | 影響度 | 対策 |
|--------|------|--------|------|
| 過剰補正（正しいテキストを誤修正） | 中 | 高 | 補正前後のログ出力、慎重な辞書選定 |
| 処理速度低下 | 低 | 中 | ベンチマーク測定、最適化 |
| 既存機能への影響 | 低 | 高 | 統合テスト実施 |

---

## 📝 参考資料

- [v1.0.16 テスト報告書](TEST_REPORT_v1.0.16_2025-11-15.md)
- [OCR精度分析](../ocr_accuracy_analysis.md)
- [開発ログ](DEVELOPMENT_LOG.md)

---

**承認**: 未承認
**最終更新**: 2025年11月15日 22:40
